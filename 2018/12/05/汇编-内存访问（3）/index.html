<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">

  
  <script src="/js/script.js"></script>
  

  <title>caozhenwei</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/bootstrap.css" >
</head>
  <body>
    <header class="header-content">
<div class="header">
  <div class="blog-title">
    <img class="logo" src="https://raw.githubusercontent.com/caozhenwei/blog_pic/master/header_image_small.jpeg">
    <a href="/" class="title">caozhenwei</a>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link">Home</a>
        </li>
      
        <li class="menu-item">
          <a href="/archives" class="menu-item-link">Archives</a>
        </li>
      
    </ul>
  </nav>
</div>
</header>
    <main class="main">
      <div class="content">
  <article class="article">
    <div class="article-detail">
      <!-- 标题 -->
      <div class="article-title">
        <h2 class="title">汇编--内存访问（3）</h2>
      </div>

      <!-- 时间 -->
      <div class="article-meta">
        <span class="article-time">2018-12-05</span>
      </div>

      <!-- 文章内容 -->
      <div class="article-content">
        <h4 id="内存中字的存储"><a href="#内存中字的存储" class="headerlink" title="内存中字的存储"></a>内存中字的存储</h4><p>8086 的寄存器是 16 位的，怎么存储一个字呢？很简单，因为一个字为 2 个字节，那么高 8 位存放高位字节，低 8 位存储低位字节就行了。</p>
<a id="more"></a>
<h4 id="内存访问"><a href="#内存访问" class="headerlink" title="内存访问"></a>内存访问</h4><p>通过前面的学习，我们知道 mov 指令的基本操作，它可以有一下几种形式：</p>
<ul>
<li>mov 寄存器，数据</li>
<li>mov 寄存器，寄存器</li>
</ul>
<p>我们怎么把内存中的数据转移到寄存器中呢？猜想应该是 <code>mov 寄存器 内存单元</code>。内存的表示方法为基址加偏移地址，可以用 <code>[...]</code> 表示偏移地址，那段地址在哪里呢？先来回顾下 8086 是怎么从内存单元中取指令并且执行的，方法为 CS：IP，CS 表示为段寄存器，IP 表示偏移，从中我们联想到要从内存中取数据，段地址应该默认放在某个寄存器中。对的，从内存中取数据的话，段地址默认放在 DS 中，偏移地址由 <code>[...]</code> 给出。知道了表示方法后就可以用 <code>mov 寄存器 内存单元</code> 来取数据了。格式如下：</p>
<pre><code>mov ax [0]
</code></pre><p>上面这条指令表示的意义为从内存单元 DS：[0]    中取数据放到 ax 寄存器中。<code>DS：[0]</code> 表示的意义为段地址在 DS 中，偏移为 0 。以后就用 <code>DS：[0]</code> 这种方法来表示一个内存单元。能从内存中取数据到寄存器中，当然就可以把寄存器中的数据放到内存中。表示方法如下：</p>
<pre><code>mov [0] ax
</code></pre><p>表示的意义为把 ax 中的数据放入内存单元 DS：[0] 中。</p>
<p><mark>8086 不允许把数据直接放入段寄存器</mark>，要想把数据送入段寄存器，可以先把数据放入通用寄存器，在把通用寄存器的数据放入段寄存器，例子如下：</p>
<pre><code>mov ax，1000H
mov ds，ax
</code></pre><p>在编写汇编代码时，可以根据需要将一组单元定义为一个段。比如我们用 123B0H ~ 123BAH 这段内存空间来存放数据，则可以认为 123B0H ~ 123BAH 这个段为数据段。其实内存并没被分段，只是人主观的把它视为一个数据段。现在想把 123B0H ~ 123BAH 这个数据段中内容累加，代码如下：</p>
<pre><code>mov ax，123B0H
mov bx，ax
mov al，0
add al，[0]
add al，[2]
add al，[3]
</code></pre><h4 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h4><p>栈是一种先进后出的一种数据结构，在编写汇编代码的时候我们可以将一块内存当做栈来使用。说到栈自然想到栈的两种基本操作，即入栈和出栈。在汇编语言中 push 和 pop 分别表示入栈和出栈。如 push ax 表示把 ax 中的数据送入栈中，pop ax 表示把栈顶取出数据送入 ax 中。这里有一点需要注意：<mark>入栈和出栈的操作都是以字为单位的</mark>。入栈的时候把数据放入栈顶，出栈的时候从栈顶取出数据。那么 CPU 怎么知道哪段内存是我们定义的栈呢？怎么知道栈顶单元呢？再回想前面的知识，CPU 怎么知道当前要执行的质指令的位置呢？从 CS、IP 指向的段地址和偏移地址中取。那 CPU 怎么从内存单元中取数据呢？从 DS、[xxx] 指向的段地址和偏移地址。那 CPU 怎么知道栈顶单元呢？根据猜想它应该是根据寄存器中应该保存着这些信息。恭喜你又一次答对了，这种举一反三的能力很强，可以奖励自己一个鸡腿当晚餐。栈顶的段地址放在段寄存器 SS 中，偏移地址放在 SP 中。<mark>任意时刻，SS：SP 指向栈顶元素</mark>。</p>
<p>push 的执行分以下两步：</p>
<ul>
<li>SP = SP - 2，SS：SP 指向当前栈顶前面的单元，以当前栈顶前面的栈顶为新的单元</li>
<li>将 ax 的内容送入 SS：SP 指向的内存单元处，SS：SP 此时指向新栈顶</li>
</ul>
<p>pop ax 由以下两步完成</p>
<ul>
<li>将 SS：SP 指向的内存单元处的数据送入 ax</li>
<li>SP = SP + 2，SS：SP 指向当前栈顶下面的单元，以当前栈顶下面的单元为新的栈顶</li>
</ul>
<p>当栈满后再向里面 push 数据，或者栈空的时候再次 pop 数据，都将造成栈越界问题，所以写代码的时候要非常的小心保证栈不能越界。</p>
<p>我们可以一块内存当做栈来使用，称为栈段，那么栈段最大是多少呢？这个问题只需要考虑 SP 即可，因为 SP 的范围为 0 ~ FFFFH，所以栈段的最大容量为 64KB。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>通过这次学习，知道了字是怎么存储的，即高 8 位存放高位字节，低 8 位存放低位字节；知道了用 DS：[xxx] 的方式访问内存中的数据；知道了栈的概念和它的基本操作 push 和 pop，SS：SP 指向栈顶元素。</p>

      </div>
    </div>
  </article>

  <!-- 目录 -->
  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">目录</strong>
    
        <ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#内存中字的存储"><span class="nav-text">内存中字的存储</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#内存访问"><span class="nav-text">内存访问</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#栈"><span class="nav-text">栈</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-text">总结</span></a></li></ol>
    
    </div>
  </aside>
</div>

<footer id="footer">
    <p> Powered_by
     <a href="http://hexo.io/" target="_blank">Hexo</a>
     and 
     <a href="https://github.com/caozhenwei/zw_theme" target="_blank">Hexo-theme-zw_theme  
     </a> 
      , copyright &copy; 2018 - 2019 caozhenwei All Rights Reserved.
    </p>
</footer>
    </main>
  </body>
</html>